<%
issue_subscription =
  category.issues_subscription(current_user, init: true)
task_subscription =
  category.tasks_subscription(current_user, init: true)
%>

<div id="category-<%= category.id %>" class="category">
  <div class="category-name-and-tags">
    <h3 class="category-name"><%= link_to category.name, category %></h3>
    <%= category_tags(category) %>
  </div>

  <div class="category-counts">
    <%= content_tag :p, pluralize(category.projects.size, 'Project'),
                        class: 'category-project-count' %>

    <%# TODO: change to open issues %>
    <p class="category-issues-link">
      <%= link_to_if can?(:read, Issue),
                     pluralize(category.issues.count, 'Issue'),
                     category_issues_path(category) %>
    </p>

    <%# TODO: change to open tasks %>
    <p class="category-tasks-link">
      <%= link_to_if can?(:read, Task),
                     pluralize(category.tasks.count, 'Task'),
                     category_tasks_path(category) %>
    </p>
  </div>

  <p class="category-links">
    <%= render issue_subscription, category: category %>
    <%= render task_subscription, category: category %>

    <% if can?(:destroy, category) %>
      <%= link_to 'Delete', category_path(category),
                  method: :delete, data: { confirm: 'Are you sure?' },
                  class: 'button button-outline button-warning' %>
    <% end %>
    <% if can?(:update, category) %>
      <%= link_to 'Edit', edit_category_path(category),
                  class: 'button button-outline' %>
    <% end %>
  </p>
</div>
